<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pizza Factory Slise Menu</title>
  <link rel="stylesheet" href="../assets/css/styles.css">

  <link rel="shortcut icon" href="../assets/img/favicon.png" type="image/x-icon">
  <script>
      const NavUrl = 'navbar.html'; // Replace with your actual navbar URL
      const FooterUrl = 'footer.html'; // Replace with your actual footer URL
  </script>
  <style>
    :root {
      --primary-color: #ce221f;
      --text-dark: #3e2723;
    }

    body {
     background-color: #fff3e0;
     color: var(--text-dark);
     margin: 0;
    }

    .menu-page-content {
      font-family: 'Segoe UI', sans-serif;
    }

    /* === Filter Section === */
    .filters-wrapper {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 15px;
      background-color: #fbc02d;
      padding: 15px;
      padding-top: 90px;
    }

    .filters-wrapper input[type="text"] {
      padding: 8px 15px;
      border-radius: 25px;
      border: none;
      font-size: 16px;
      width: 250px;
    }

    .filters-wrapper .filters {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
    }

    .filters button {
      background-color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 25px !important;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.3s;
    }

    .filters button.active {
      background-color: var(--primary-color);
      color: white;
    }

    /* === Floating Menu Button === */
    .menu-toggle {
      position: fixed;
      bottom: 25px;
      right: 25px;
      background-color: #000;
      color: white;
      border: none;
      border-radius: 50%;
      width: 65px;
      height: 65px;
      font-weight: bold;
      font-size: 14px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
      z-index: 1000;
      cursor: pointer;
    }

    .menu-popup {
      position: fixed;
      bottom: 100px;
      right: 20px;
      background-color: #0f1113;
      color: white;
      padding: 20px 30px;
      border-radius: 20px;
      box-shadow: 0 4px 30px rgba(0,0,0,0.4);
      z-index: 999;
      font-family: 'Arial', sans-serif;
      max-width: 300px;
      width: 90%;
    }

    .menu-popup h3 {
      font-size: 18px;
      margin-bottom: 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .menu-popup button {
      display: block;
      width: 100%;
      text-align: left;
      background: none;
      border: none;
      color: white;
      font-size: 15px;
      font-weight: 500;
      margin: 8px 0;
      padding: 6px 0;
      cursor: pointer;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }

    .menu-popup.hidden {
      display: none;
    }

    /* === Menu Cards Layout === */
    .menu-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      padding: 20px;
      justify-items: center;
    }

    @media (min-width: 992px) {
      .menu-container {
        grid-template-columns: repeat(3, 1fr);
      }
    }

    .menu-card {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      background: #fff;
      border-bottom: 1px solid #eee;
      padding: 15px;
      border-radius: 8px;
      gap: 10px;
      width: 100%;
      max-width: 720px;
      animation: fadeInUp 0.6s ease forwards;
      opacity: 0;
    }

    .menu-info { flex: 1; }

    .menu-info h4 {
      margin: 0 0 5px;
      font-size: 18px;
      font-weight: 600;
    }

    .menu-info p {
      margin: 6px 0;
      font-size: 14px;
      color: #666;
    }

    .price-line {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .original-price {
      text-decoration: line-through;
      color: #888;
      font-size: 14px;
    }

    .discounted-price {
      color: #0f8f04;
      font-weight: bold;
      font-size: 16px;
    }

    .menu-img-block {
      width: 130px;
      position: relative;
      text-align: center;
    }

    .menu-img-block img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 10px;
    }

    .customise-btn-cart {
      margin-left: 10px;
      background-color: #eee;
      color: #b71c1c;
      font-size: 12px;
      padding: 3px 8px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      display: inline-block;
    }

    .order-button {
      background-color: #0f8f04;
      color: white;
      padding: 6px 12px;
      border: none;
      border-radius: 12px;
      font-weight: 600;
      font-size: 16px;
      cursor: pointer;
      width: 100%;
      margin-top: 15px;
    }

    .order-button:hover {
      background-color: #087b01;
    }

    .veg-icon, .nonveg-icon {
      width: 14px;
      height: 14px;
      border-radius: 50%;
      display: inline-block;
      margin-right: 5px;
    }

    .veg-icon {
      border: 1px solid green;
      background: green;
    }

    .nonveg-icon {
      border: 1px solid red;
      background: red;
    }

    /* === Generic Modal === */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.7);
      justify-content: center;
      align-items: center;
      z-index: 999;
    }

    .modal-content {
      background: white;
      padding: 20px;
      border-radius: 10px;
      width: 90%;
      max-width: 400px;
      position: relative;
      text-align: center;
    }

    .modal-close {
      position: absolute;
      right: 15px;
      top: 10px;
      cursor: pointer;
      font-weight: bold;
    }

    input {
      padding: 10px;
      margin: 5px 0;
      width: 90%;
    }

    ul {
      padding-left: 0;
      list-style: none;
      text-align: left;
    }

    ul li {
      margin-bottom: 6px;
    }

    /* === Cart Modal Styling === */
    #stickyCartBtn {
      position: fixed;
      bottom: 25px;
      left: 25px;
      z-index: 9999;
      border-radius: 50px;
      padding: 10px 20px;
      background-color: #1bbf49;
      color: white;
      border: none;
    }

    #cartModal .modal-content {
      width: fit-content;
      max-width: 90vw; 
      min-width: 300px;
      padding: 25px;
      max-height: 80vh;
    }

    #cartModal h3 {
      text-align: center;
      font-size: 24px;
      margin-bottom: 15px;
      color: #b71c1c;
    }

    #cartItems {
      max-height: 300px;
      overflow-y: auto;
      margin-bottom: 15px;
      scrollbar-width: none;
      -ms-overflow-style: none;
    }

    #cartItems li {
      display: flex;
      justify-content: space-between; /* Distributes items along the line */
      align-items: center;
      margin-bottom: 10px;
      padding: 8px 0;
      border-bottom: 1px dashed #ccc;
    }

    #cartItems li span.title {
      flex: 1; /* Allows title to take available space */
      font-weight: 600;
      color: #333;
      text-align: left; /* Ensure title is left-aligned */
    }

    .cart-item-size {
        font-size: 0.9em; /* Slightly smaller font for size */
        color: #666;
        margin-left: 5px; /* Space between title and size */
        font-weight: normal; /* Make size less bold than title */
    }

    /* Styles for quantity controls in cart modal */
    .cart-quantity-controls { /* New class */
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 16px;
      font-weight: bold;
      margin-left: 15px; /* Added gap */
    }

    .cart-quantity-controls button {
      border: none;
      background-color: #f0f0f0;
      font-weight: bold;
      width: 28px;
      height: 28px;
      border-radius: 6px;
      cursor: pointer;
      color: #b71c1c;
    }

    /* Style for the price */
    .cart-item-price {
        font-weight: bold;
        color: #b71c1c;
        margin-left: 20px; /* Space between quantity controls and price */
        min-width: 60px; /* Ensure space for price */
        text-align: right; /* Align price to the right within its space */
    }
    
    #cartCountBadge {
      background-color: #1bbf49;
      color: white;
      padding: 0px 0px;
      font-size: 18px;
      border-radius: 10px;
      margin-left: 6px;
    }

    .cart-item-info {
  display: flex;
  flex-direction: column;
  align-items: flex-start;
}

.cart-topping-line {
  font-size: 13px;
  color: #555;
  margin-left: 2px;
  margin-top: 2px;
}
    /* === Order Form Modal Styling === */
    #orderFormModal .modal-content {
      max-width: 420px;
      background: #fff;
      border-radius: 20px;
      padding: 25px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2);
      text-align: center;
    }

    #orderFormModal h3 {
      color: #b71c1c;
      font-size: 22px;
      margin-bottom: 15px;
    }

    #orderForm input {
      padding: 12px;
      width: 90%;
      margin-bottom: 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 16px;
    }

    #orderForm .order-button {
      width: 100%;
      background-color: #b71c1c;
      font-size: 16px;
      border-radius: 12px;
      margin-top: 10px;
    }

    /* === Animation Styles === */
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Styles for quantity control on menu cards */
    .quantity-control {
      display: flex;
      align-items: center;
      gap: 5px; /* Reduced gap for a tighter look */
      margin-top: 8px;
      justify-content: center;
      width: 100%; /* Ensure it takes full width of the block */
    }

    .qty-btn {
      background-color: var(--primary-color); /* Changed to primary color for consistency */
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
      flex-grow: 1; /* Allow buttons to grow */
    }

    .qty-btn.delete {
        background-color: #f0f0f0; /* Changed to match '+' button background */
        color: #dc3545; /* Keep the 'x' symbol red */
    }

    .qty-count {
      font-weight: bold;
      font-size: 16px;
      padding: 6px 10px; /* Added padding for better appearance */
      border: 1px solid #ccc; /* Add a border to the count */
      border-radius: 6px;
      min-width: 30px; /* Ensure a minimum width */
      text-align: center;
    }

    /* New styles for customize modal */
    #customiseModal .modal-content {
        max-width: 480px;
        text-align: left;
        max-height: 80vh; /* Set a maximum height, e.g., 80% of viewport height */
        overflow-y: auto; /* Add scrollbar if content exceeds max-height */
    }

    #customiseModal h3 {
        text-align: center;
        color: var(--primary-color);
        margin-bottom: 20px;
    }

    #customiseModal h4 {
        margin-top: 15px;
        margin-bottom: 10px;
        color: var(--text-dark);
        font-size: 16px;
    }

    #customiseModal .option-group {
        margin-bottom: 15px;
        border: 1px solid #eee;
        padding: 10px;
        border-radius: 8px;
    }

    #customiseModal .option-group label {
        display: block;
        margin-bottom: 8px;
        font-size: 14px;
        cursor: pointer;
    }

    #customiseModal input[type="radio"],
    #customiseModal input[type="checkbox"] {
        width: auto;
        margin-right: 8px;
    }

    #customiseModal .total-price-display {
        text-align: right;
        font-size: 20px;
        font-weight: bold;
        margin-top: 20px;
        color: var(--primary-color);
    }

    #customiseModal .order-button {
        background-color: var(--primary-color);
    }

  </style>
</head>
<body>
  <div id="navbar-container"></div>

  <div class="menu-page-content">

  <div class="filters-wrapper">
    <input type="text" id="searchBox" placeholder="Search menu..." onkeyup="searchMenu()" />
    <div class="filters">
      <button class="type-filter " onclick="filterByType(event, 'all')">All</button>
      <button class="type-filter" onclick="filterByType(event, 'veg')">Veg</button>
      <button class="type-filter" onclick="filterByType(event, 'nonveg')">Non-Veg</button>
    </div>
  </div>

  <button id="menuToggleBtn" class="menu-toggle" onclick="toggleMenuPopup()">MENU</button>

  <div id="menuPopup" class="menu-popup hidden">
    <button class="tablink" onclick="openTab(event, 'all')">All</button>
    <button class="tablink" onclick="openTab(event, 'pizzamania')">Pizza Mania</button>
    <button class="tablink" onclick="openTab(event, 'pizzas')">Pizzas</button>
    <button class="tablink" onclick="openTab(event, 'burgers')">Burgers</button>
    <button class="tablink" onclick="openTab(event, 'sides')">Sides</button>
    <button class="tablink" onclick="openTab(event, 'beverages')">Beverages</button>
    <button class="tablink" onclick="openTab(event, 'icecreams')">Ice Creams</button>
    <button class="tablink" onclick="openTab(event, 'combos')">Combos</button>
  </div>

  <div id="menu" class="menu-container active"></div>

  <div id="cartModal" class="modal" onclick="handleModalOutsideClick(event, 'cartModal')">
    <div class="modal-content" onclick="event.stopPropagation()">
      <span class="modal-close" onclick="closeCartModal()">Ã—</span>
      <h3>Your Cart</h3>
      <ul id="cartItems"></ul>
      <p style="text-align:right; margin-top: 10px;">
        <strong>Total:</strong> <span id="cartTotal">â‚¹0</span>
      </p>
      <button class="order-button" onclick="openOrderForm()">Order Now</button>
    </div>
  </div>

  <button id="stickyCartBtn" style="font-weight: bold;" onclick="openCartModal()">ðŸ›’ View Cart<span id="cartCountBadge">[0]</span></button>

  <div id="orderFormModal" class="modal">
    <div class="modal-content">
      <span class="modal-close" onclick="closeOrderForm()">Ã—</span>
      <h3>Enter Your Details</h3>
      <form id="orderForm" onsubmit="submitOrder(event)">
        <input type="text" id="custName" placeholder="Your Name" required />
        <input type="text" id="custAddress" placeholder="Your Address" required />
        <input type="tel" id="custPhone" placeholder="Phone Number" required />
        <button type="button" class="order-button" onclick="makePayment()">ðŸ’³ Make Payment</button>
      </form>
    </div>
  </div>

  <div id="customiseModal" class="modal">
    <div class="modal-content">
      <span class="modal-close" onclick="closeCustomiseModal()">Ã—</span>
      <h3 id="customisePizzaName"></h3>

      <div class="option-group">
        <h4>Change Size</h4>
        <label><input type="radio" name="pizzaSize" value="Regular" data-price="309" checked> Regular: â‚¹309</label>
        <label><input type="radio" name="pizzaSize" value="Medium" data-price="519"> Medium: â‚¹519</label>
        <label><input type="radio" name="pizzaSize" value="Large" data-price="709"> Large: â‚¹709</label>
      </div>

      <div class="option-group">
        <h4>Change Crust</h4>
        <label><input type="radio" name="pizzaCrust" value="Standard" data-price="0" checked> Standard Crust</label>
        <label><input type="radio" name="pizzaCrust" value="Cheese Volcano Crust" data-price="309"> Cheese Volcano Crust: â‚¹309</label>
        <label><input type="radio" name="pizzaCrust" value="Extra Cheese on Crust" data-price="50"> Extra Cheese on Crust: â‚¹50</label>
      </div>

      <div class="option-group">
        <h4>Add Veg Toppings</h4>
        <label><input type="checkbox" name="vegTopping" value="Crisp Capsicum" data-price="35"> Crisp Capsicum: â‚¹35</label>
        <label><input type="checkbox" name="vegTopping" value="Fresh Tomato" data-price="35"> Fresh Tomato: â‚¹35</label>
        <label><input type="checkbox" name="vegTopping" value="Paneer" data-price="35"> Paneer: â‚¹35</label>
        <label><input type="checkbox" name="vegTopping" value="Red Pepper" data-price="35"> Red Pepper: â‚¹35</label>
        <label><input type="checkbox" name="vegTopping" value="Jalapeno" data-price="35"> Jalapeno: â‚¹35</label>
        <label><input type="checkbox" name="vegTopping" value="Black Olive" data-price="35"> Black Olive: â‚¹35</label>
        <label><input type="checkbox" name="vegTopping" value="Grilled Mushrooms" data-price="35"> Grilled Mushrooms: â‚¹35</label>
        <label><input type="checkbox" name="vegTopping" value="Onion" data-price="35"> Onion: â‚¹35</label>
      </div>

      <div class="option-group">
        <h4>Add Non-Veg Toppings</h4>
        <label><input type="checkbox" name="nonVegTopping" value="Pepper Barbecue Chicken" data-price="50"> Pepper Barbecue Chicken: â‚¹50</label>
        <label><input type="checkbox" name="nonVegTopping" value="Peri-Peri Chicken" data-price="50"> Peri-Peri Chicken: â‚¹50</label>
        <label><input type="checkbox" name="nonVegTopping" value="Grilled Chicken Rasher" data-price="50"> Grilled Chicken Rasher: â‚¹50</label>
        <label><input type="checkbox" name="nonVegTopping" value="Chicken Sausage" data-price="50"> Chicken Sausage: â‚¹50</label>
        <label><input type="checkbox" name="nonVegTopping" value="Chicken Tikka" data-price="50"> Chicken Tikka: â‚¹50</label>
        <label><input type="checkbox" name="nonVegTopping" value="Chicken Pepperoni" data-price="50"> Chicken Pepperoni: â‚¹50</label>
        <label><input type="checkbox" name="nonVegTopping" value="Chicken Keema" data-price="50"> Chicken Keema: â‚¹50</label>
      </div>

      <p class="total-price-display">Total: <span id="customiseTotalPrice">â‚¹0</span></p>
    <div style="display: flex; gap: 10px; justify-content: space-between;">
      <button id="saveEditBtn" class="order-button" onclick="saveCustomisationChanges()" style="display:none;">ðŸ’¾ Save Edits</button>
      <button class="order-button" onclick="addCustomisedItemToCart(true)">âž• Add As New</button>
    </div>

    </div>
  </div>

  </div>
 <div id="footer-container"></div>

  <script src="load.js"></script>

  <script>
/* === MENU DATA === */
// Refactored menuData to use 'sizes' object for multi-size items
const menuData = [
  //Pizza Mania
  { category: 'pizzamania', title: 'Onion Pizza', desc: 'Mozerella cheese, onion', price: 'â‚¹79', img: '../assets/img/product-1.png', type: 'veg' },
  { category: 'pizzamania', title: 'Capsicum Onion Pizza', desc: 'Mozerella cheese, Capsicum, onion', price: 'â‚¹89', img: '../assets/img/product-2.png', type: 'veg' },
  { category: 'pizzamania', title: 'Mushroom Red Paprika Pizza', desc: 'Mozerella cheese, Mushroom, red paprika', price: 'â‚¹89', img: 'assets/img/farm-land-slice.jpg', type: 'veg' },
  { category: 'pizzamania', title: 'Corn Pizza Mania Pizza', desc: 'Mozerella cheese, Corn', price: 'â‚¹89', img: 'assets/img/farm-land-slice.jpg', type: 'veg' },
  { category: 'pizzamania', title: 'Jalapeno And Corn Mania Pizza', desc: 'Mozerella cheese, Corn, Jalapeno', price: 'â‚¹89', img: 'assets/img/farm-land-slice.jpg', type: 'veg' },
  { category: 'pizzamania', title: 'Olive And Onion Mania Pizza', desc: 'Mozerella cheese, Olive, onionn', price: 'â‚¹89', img: 'assets/img/farm-land-slice.jpg', type: 'veg' },
  { category: 'pizzamania', title: 'Mushroom Pizza', desc: 'Mozerella cheese, Mushroom', price: 'â‚¹79', img: 'assets/img/farm-land-slice.jpg', type: 'veg' },

  // Veg Pizzas
  { category: 'pizzas', title: 'Margarita Pizza', desc: 'Mozerella cheese', sizes: { Regular: 'â‚¹169', Medium: 'â‚¹289', Large: 'â‚¹449' }, img: '', type: 'veg' },
  { category: 'pizzas', title: 'Paneer Tikka Delight', desc: 'Mozerella cheese, onion, green capsicum, red paprika, paneer tikka', sizes: { Regular: 'â‚¹179', Medium: 'â‚¹319', Large: 'â‚¹479' }, img: '', type: 'veg' },
  { category: 'pizzas', title: 'Farm Land Pizza', desc: 'Mozerella cheese, onion, tomato, corn, green capsicum', sizes: { Regular: 'â‚¹179', Medium: 'â‚¹319', Large: 'â‚¹479' }, img: '', type: 'veg' },
  { category: 'pizzas', title: 'Tandoori Veggie Feast Pizza', desc: 'Mozerella cheese, onion, tomato, green capsicum, tandoori paneer', sizes: { Regular: 'â‚¹189', Medium: 'â‚¹339', Large: 'â‚¹499' }, img: '', type: 'veg' },
  { category: 'pizzas', title: 'Veggie Supreme Delight Pizza', desc: 'Mozerella cheese, onion, yellow capsicum, green capsicum, red paprika, corn, mushroom', sizes: { Regular: 'â‚¹189', Medium: 'â‚¹339', Large: 'â‚¹499' }, img: '', type: 'veg' },
  { category: 'pizzas', title: 'Paneer Delight Explosion Pizza', desc: 'Mozerella cheese, jalapeno, yellow capsicum, onion, red paprika, masala paneer', sizes: { Regular: 'â‚¹189', Medium: 'â‚¹339', Large: 'â‚¹499' }, img: '', type: 'veg' },
  { category: 'pizzas', title: 'Pineapple Passion Blast Pizza', desc: 'Mozerella cheese, onion, pineapple, corn, red paprika', sizes: { Regular: 'â‚¹179', Medium: 'â‚¹319', Large: 'â‚¹479' }, img: '', type: 'veg' },
  { category: 'pizzas', title: 'Pizza Factory Slise Special Pizza', desc: 'Mozerella cheese, onion, red paprika, green capsicum, olives, special spicy sauce', sizes: { Regular: 'â‚¹189', Medium: 'â‚¹339', Large: 'â‚¹499' }, img: '', type: 'veg' },
  { category: 'pizzas', title: 'BBQ Veggie Bonanza Pizza', desc: 'Mozerella cheese, onion, corn, mushroom, jalapeno, BBQ sauce', sizes: { Regular: 'â‚¹189', Medium: 'â‚¹339', Large: 'â‚¹499' }, img: '', type: 'veg' },
  { category: 'pizzas', title: 'Baby Corn Fiesta Pizza', desc: 'Mozerella cheese, baby corn, tomato, green capsicum, mushroom', sizes: { Regular: 'â‚¹199', Medium: 'â‚¹359', Large: 'â‚¹529' }, img: '', type: 'veg' },
  { category: 'pizzas', title: 'Peri Peri Paneer Paradise Pizza', desc: 'Mozerella cheese, onion, jalapeno, red capsicum, corn, peri peri paneer', sizes: { Regular: 'â‚¹189', Medium: 'â‚¹339', Large: 'â‚¹499' }, img: '', type: 'veg' },
  { category: 'pizzas', title: 'Paneer Perfection Pizza', desc: 'Mozerella cheese, onion, paneer, corn, green capsicum', sizes: { Regular: 'â‚¹189', Medium: 'â‚¹339', Large: 'â‚¹499' }, img: '', type: 'veg' },
  { category: 'pizzas', title: 'Mix Veggie Medley Pizza', desc: 'Mozerella cheese, onion, green capsicum, red capsicum, corn, tomato, jalapeno, olives', sizes: { Regular: 'â‚¹199', Medium: 'â‚¹359', Large: 'â‚¹529' }, img: '', type: 'veg' },
  { category: 'pizzas', title: 'Paneer Makhani Marvel Pizza', desc: 'Mozerella cheese, onion, baby corn, red capsicum, mushroom, makhani paneer', sizes: { Regular: 'â‚¹189', Medium: 'â‚¹339', Large: 'â‚¹499' }, img: '', type: 'veg' },
  { category: 'pizzas', title: 'Tandoori Twist Pizza', desc: 'Mozerella cheese, red capsicum, green capsicum, corn, jalapeno, tandoori sauce', sizes: { Regular: 'â‚¹199', Medium: 'â‚¹359', Large: 'â‚¹529' }, img: '', type: 'veg' },
  { category: 'pizzas', title: 'Fiery Fusion Surprise Pizza', desc: 'Mozerella cheese, onion, red paprika, jalapeno, green chilli, yellow capsicum, toping on jalapeno sause', sizes: { Regular: 'â‚¹179', Medium: 'â‚¹319', Large: 'â‚¹479' }, img: '', type: 'veg' },
  { category: 'pizzas', title: 'Capsicum Corn Sensation Pizza', desc: 'Mozerella cheese, onion, corn, red capsicum, toping on mint sause, golden corn', sizes: { Regular: 'â‚¹199', Medium: 'â‚¹359', Large: 'â‚¹529' }, img: '', type: 'veg' },
  { category: 'pizzas', title: 'Chhese Gold Corn Pizza', desc: 'Mozerella cheese, goldenn corn', sizes: { Regular: 'â‚¹189', Medium: 'â‚¹339', Large: 'â‚¹499' }, img: '', type: 'veg' },
  { category: 'pizzas', title: 'Olive Paradise Pizza', desc: 'Mozerella cheese, olive, green capsicum, corn, red paprika', sizes: { Regular: 'â‚¹179', Medium: 'â‚¹319', Large: 'â‚¹479' }, img: '', type: 'veg' },

  // Non-Veg Pizzas
  { category: 'pizzas', title: 'Chicken Tikka Masala Madness Pizza', desc: 'Mozerella cheese, chicken tikka, onion, capsicum', sizes: { Regular: 'â‚¹199', Medium: 'â‚¹369', Large: 'â‚¹549' }, img: '', type: 'nonveg' },
  { category: 'pizzas', title: 'BBQ Chicken Blast Pizza', desc: 'Mozerella cheese, BBQ chicken, onion, jalapeno', sizes: { Regular: 'â‚¹209', Medium: 'â‚¹389', Large: 'â‚¹579' }, img: '', type: 'nonveg' },
  { category: 'pizzas', title: 'Spicy Chicken Sausage Surprise Pizza', desc: 'Mozerella cheese, chicken sausage, red paprika', sizes: { Regular: 'â‚¹209', Medium: 'â‚¹389', Large: 'â‚¹579' }, img: '', type: 'nonveg' },
  { category: 'pizzas', title: 'Sweet Chilli Chicken Sensation Pizza', desc: 'Mozerella cheese, onion, mushroom, capsicum, sweet chilli chicken', sizes: { Regular: 'â‚¹249', Medium: 'â‚¹449', Large: 'â‚¹649' }, img: '', type: 'nonveg' },
  { category: 'pizzas', title: 'Chicken Salami Sensation Pizza', desc: 'Mozerella cheese, chicken salami, jalapeno', sizes: { Regular: 'â‚¹199', Medium: 'â‚¹369', Large: 'â‚¹549' }, img: '', type: 'nonveg' },
  { category: 'pizzas', title: 'Chicken Pepperoni Perfection Pizza', desc: 'Mozerella cheese, chicken pepperoni', sizes: { Regular: 'â‚¹209', Medium: 'â‚¹389', Large: 'â‚¹579' }, img: '', type: 'nonveg' },
  { category: 'pizzas', title: 'Chicken Tandoori Temptation Pizza', desc: 'Mozerella cheese, onion, capsicum, tomato, tandoori chicken', sizes: { Regular: 'â‚¹209', Medium: 'â‚¹389', Large: 'â‚¹579' }, img: '', type: 'nonveg' },
  { category: 'pizzas', title: 'Peri Peri Chicken Explosion Pizza', desc: 'Mozerella cheese, onion, green capsicum, red paprika, peri peri chicken', sizes: { Regular: 'â‚¹209', Medium: 'â‚¹389', Large: 'â‚¹579' }, img: '', type: 'nonveg' },
  { category: 'pizzas', title: 'Chicken Tikka Paneer Fusion Pizza', desc: 'Mozerella cheese, onion, chicken tikka, paneer', sizes: { Regular: 'â‚¹249', Medium: 'â‚¹449', Large: 'â‚¹649' }, img: '', type: 'nonveg' },
  { category: 'pizzas', title: 'Non-Veg Loaded Pizza', desc: 'Mozerella cheese, red paprika, BBQ chicken, chicken tikka, chicken pepperoni', sizes: { Regular: 'â‚¹219', Medium: 'â‚¹409', Large: 'â‚¹599' }, img: '', type: 'nonveg' },
  { category: 'pizzas', title: 'Golden Chicken Crunch Pizza', desc: 'Mozerella cheese, corn, onion, chicken', sizes: { Regular: 'â‚¹209', Medium: 'â‚¹389', Large: 'â‚¹579' }, img: '', type: 'nonveg' },
  { category: 'pizzas', title: 'Pizza Factory Slise Special Pizza', desc: 'Mozerella cheese, onion, chicken, jalapeno, corn, special spicy sauce', sizes: { Regular: 'â‚¹209', Medium: 'â‚¹389', Large: 'â‚¹579' }, img: '', type: 'nonveg' },

// Veg Burgers
  { category: 'burgers', title: 'Veggie Victory Burger', desc: 'Delicious veg patty with lettuce and creamy mayo', price: 'â‚¹119', img: 'assets/img/veg-burger-1.jpg', type: 'veg' },
  { category: 'burgers', title: 'Spicy Hero Veg Burger', desc: 'Veg patty with lettuce, mayo, and spicy sauce', price: 'â‚¹129', img: 'assets/img/veg-burger-2.jpg', type: 'veg' },
  { category: 'burgers', title: 'Nutty Professor Veg Burger', desc: 'Veg patty with lettuce, onion, tomato and mayo', price: 'â‚¹139', img: 'assets/img/veg-burger-3.jpg', type: 'veg' },
  { category: 'burgers', title: 'Fiery Fajita Veg Burger', desc: 'Delicious Veg patty and crunchy lettuce and onion and tomato with mayo', price: 'â‚¹139', img: 'assets/img/veg-burger-3.jpg', type: 'veg' },
  { category: 'burgers', title: 'Nacho Vixen Burger', desc: ' Delicious veg patty, crunchy lettuce and crispy nachos and flavored  mayo', price: 'â‚¹149', img: 'assets/img/veg-burger-4.jpg', type: 'veg' },
  
  // Non-Veg Burgers
  { category: 'burgers', title: 'Nonveg Victory Burger', desc: 'Delicious veg patty with lettuce and creamy mayo', price: 'â‚¹129', img: 'assets/img/veg-burger-1.jpg', type: 'nonveg' },
  { category: 'burgers', title: 'Spicy Hero Chicken Burger', desc: 'Veg patty with lettuce, mayo, and spicy sauce', price: 'â‚¹139', img: 'assets/img/veg-burger-2.jpg', type: 'nonveg' },
  { category: 'burgers', title: 'Nutty Professor Chicken Burger', desc: 'Veg patty with lettuce, onion, tomato and mayo', price: 'â‚¹149', img: 'assets/img/veg-burger-3.jpg', type: 'nonveg' },
  { category: 'burgers', title: 'Fiery Fajita Chicken Burger', desc: 'Delicious Veg patty and crunchy lettuce and onion and tomato with mayo', price: 'â‚¹159', img: 'assets/img/veg-burger-3.jpg', type: 'nonveg' },
  { category: 'burgers', title: 'Nacho Vixen Chicken Burger', desc: ' Delicious veg patty, crunchy lettuce and crispy nachos and flavored  mayo', price: 'â‚¹179', img: 'assets/img/veg-burger-4.jpg', type: 'nonveg' },
  
  // Veg Sides
  { category: 'sides', title: 'Veg Nuggets', desc: 'Crispy Veg Nuggets', price: 'â‚¹89', img: 'assets/img/wedges.jpg', type: 'veg' },
  { category: 'sides', title: 'Veg Nachos', desc: 'Crispy Veg Nachos', price: 'â‚¹179', img: 'assets/img/wedges.jpg', type: 'veg' },
  { category: 'sides', title: 'Potato Wedges', desc: 'Crispy potato wedges', price: 'â‚¹99', img: 'assets/img/wedges.jpg', type: 'veg' },
  { category: 'sides', title: 'Freid Veg Momos', desc: 'Golden fried veg momos', price: 'â‚¹80', img: 'assets/img/veg-nuggets.jpg', type: 'veg' },
  { category: 'sides', title: 'Salted French Fries', desc: 'Crispy Salted French Fries', price: 'â‚¹85', img: 'assets/img/wedges.jpg', type: 'veg' },
  { category: 'sides', title: 'Classic Veg Cheese Nachos', desc: 'Crispy Cheese Nachos', price: 'â‚¹199', img: 'assets/img/wedges.jpg', type: 'veg' },
  { category: 'sides', title: 'Chilli Garlic Potato Pops', desc: 'Crispy potato pops', price: 'â‚¹89', img: 'assets/img/wedges.jpg', type: 'veg' },
  { category: 'sides', title: 'Peri Peri French Fries', desc: 'French fries with peri peri spice', price: 'â‚¹99', img: 'assets/img/peri-fries.jpg', type: 'veg' },

  // Non-Veg Sides
  { category: 'sides', title: 'Chicken Nuggets', desc: 'Juicy chicken nuggets', price: 'â‚¹119', img: 'assets/img/chicken-nuggets.jpg', type: 'nonveg' },
  { category: 'sides', title: 'Chicken Wings', desc: 'Spicy chicken wings', price: 'â‚¹99', img: 'assets/img/chicken-wings.jpg', type: 'nonveg' },
  { category: 'sides', title: 'Fried Chicken Momos', desc: 'Spicy chicken wings', price: 'â‚¹99', img: 'assets/img/chicken-wings.jpg', type: 'nonveg' },
  { category: 'sides', title: 'Shedard Chicken Nachos', desc: 'Spicy chicken wings', price: 'â‚¹219', img: 'assets/img/chicken-wings.jpg', type: 'nonveg' },
  { category: 'sides', title: 'Classic Shedard Chicken Cheese Nachos', desc: 'Spicy chicken wings', price: 'â‚¹249', img: 'assets/img/chicken-wings.jpg', type: 'nonveg' },
  
  // Beverages
  { category: 'beverages', title: 'Cold Coffee', desc: 'Classic chilled coffee', price: 'â‚¹129', img: 'assets/img/cold-coffee.jpg', type: 'veg' },
  { category: 'beverages', title: 'Oreo Coffee Shake', desc: 'Coffee blended with Oreo cookies', price: 'â‚¹139', img: 'assets/img/oreo-shake.jpg', type: 'veg' },
  { category: 'beverages', title: 'King of Mango Shake', desc: 'Mango flavored milkshake', price: 'â‚¹139', img: 'assets/img/mango-shake.jpg', type: 'veg' },

  // Ice Creams & Desserts
  { category: 'icecreams', title: 'Mango Icecream', desc: 'Mango Icecream', price: 'â‚¹80', img: 'assets/img/lava-cake.jpg', type: 'veg' },
  { category: 'icecreams', title: 'Sitaphal Icecream', desc: 'Sweet Sitphal icecream', price: 'â‚¹80', img: 'assets/img/choco-icecream.jpg', type: 'veg' },
  { category: 'icecreams', title: 'Tender Cocounut Icecream', desc: 'cocount icecream', price: 'â‚¹80', img: 'assets/img/choco-icecream.jpg', type: 'veg' },
  { category: 'icecreams', title: 'Anjeer', desc: 'Anjeer icecream', price: 'â‚¹80', img: 'assets/img/lava-cake.jpg', type: 'veg' },
  { category: 'icecreams', title: 'Litchi Ice Cream', desc: 'Litchi ice cream', price: 'â‚¹80', img: 'assets/img/choco-icecream.jpg', type: 'veg' },
  { category: 'icecreams', title: 'Chikoo Ice Cream', desc: 'Chikoo ice cream', price: 'â‚¹80', img: 'assets/img/vanilla-icecream.jpg', type: 'veg' },
  { category: 'icecreams', title: 'Strawberry Ice Cream', desc: 'Strawberry flavor ice cream', price: 'â‚¹80', img: 'assets/img/strawberry-icecream.jpg', type: 'veg' },
  { category: 'icecreams', title: 'Roasted Almond Ice Cream', desc: 'Almond flavour ice cream', price: 'â‚¹80', img: 'assets/img/pista-icecream.jpg', type: 'veg' },
  { category: 'icecreams', title: 'Malia Ice Cream', desc: 'Malia flavor ice cream', price: 'â‚¹80', img: 'assets/img/pista-icecream.jpg', type: 'veg' },
  { category: 'icecreams', title: 'Chocolate Ice Cream', desc: 'Rich chocolate flavor ice cream', price: 'â‚¹80', img: 'assets/img/choco-icecream.jpg', type: 'veg' },
  { category: 'icecreams', title: 'Kesarapista Ice Cream', desc: 'lesarapista flavor ice cream', price: 'â‚¹80', img: 'assets/img/blueberry-icecream.jpg', type: 'veg' },
  
  // More Combos
  { category: 'combos', title: 'Margarita Combo', desc: 'Margarita Pizza + Salted French Fries + Green Apple Mojito', price: 'â‚¹319', img: '', type: 'veg' },
  { category: 'combos', title: 'Pineapple Passion Combo', desc: 'Pineapple Passion Blast Slice Pizza + Potato Wedges + Virgin Mojito', price: 'â‚¹327', img: '', type: 'veg' },
  { category: 'combos', title: 'Paneer Delight Explosion Combo', desc: 'Paneer Delight Explosion Pizza + Veggie Victory Burger + Strawberry Season Mojito', price: 'â‚¹373', img: '', type: 'veg' },
  { category: 'combos', title: 'Chicken Tikka Masala Combo', desc: 'Chicken Tikka Masala Madness Pizza + Peri Peri French Fries + Thums Up', price: 'â‚¹298', img: '', type: 'nonveg' },
  { category: 'combos', title: 'BBQ Chicken Blast Combo', desc: 'BBQ Chicken Blast Pizza + Potato Veg Nuggets + Virgin Mojito', price: 'â‚¹347', img: '', type: 'nonveg' },
  { category: 'combos', title: 'Peri Peri Chicken Combo', desc: 'Peri Peri Chicken Explosion + Chicken Wings (3 Pieces) + Watermelon Mojito', price: 'â‚¹373', img: '', type: 'nonveg' },
  { category: 'combos', title: 'Sweet Chilli Chicken Combo', desc: 'Sweet Chilli Chicken Sensation Slice Pizza + Chicken Nuggets + Green Apple Mojito', price: 'â‚¹434', img: '', type: 'nonveg' },
  { category: 'combos', title: 'Chicken Salami Sensation Combo', desc: 'Chicken Salami Sensation Pizza + Jalapeno', price: 'â‚¹199', img: '', type: 'nonveg' },
  { category: 'combos', title: 'Mixed Slice Combo', desc: 'Farm Land Slice + Peri Peri Chicken Slice Pizza', price: 'â‚¹294', img: '', type: 'nonveg' },
  { category: 'combos', title: 'Fiery Fusion Combo', desc: 'Fiery Fusion Surprise Slice Pizza + Salted French Fries + Thums Up', price: 'â‚¹230', img: '', type: 'veg' },
  { category: 'combos', title: 'Golden Crunch & Spicy Hero Combo', desc: 'Golden Chicken Crunch Slice Pizza + Spicy Hero Veg Burger', price: 'â‚¹278', img: '', type: 'nonveg' },
  { category: 'combos', title: 'BBQ Veggie Slice & Dessert Combo', desc: 'BBQ Veggie Bonanza Slice Pizza + Choco Lava Cake + Blue Iced Mojito', price: 'â‚¹279', img: '', type: 'veg' },
  { category: 'combos', title: 'Capsicum Corn Combo', desc: 'Capsicum Corn Sensation Slice Pizza + Garlic Bread + Strawberry Mojito', price: 'â‚¹290', img: '', type: 'veg' },
  { category: 'combos', title: 'Sweet Chilli Chicken Combo 2', desc: 'Sweet Chilli Chicken Sensation Slice Pizza + Chicken Nuggets + Thums Up', price: 'â‚¹289', img: '', type: 'nonveg' },
  { category: 'combos', title: 'Cheese Corn & Peri Fries Combo', desc: 'Cheese Gold Corn Slice + Peri Peri Fries + Thums Up', price: 'â‚¹244', img: '', type: 'veg' },
  { category: 'combos', title: 'Chicken Pepperoni Combo', desc: 'Chicken Pepperoni Slice Perfection + Chilli Garlic Potato Pops + Thums Up', price: 'â‚¹313', img: '', type: 'nonveg' },
  { category: 'combos', title: 'Fiery Fajita Veg Combo', desc: 'Fiery Fajita Veg Burger + Watermelon Mocktail', price: 'â‚¹208', img: '', type: 'veg' },
  { category: 'combos', title: 'Nutty Professor Chicken Combo', desc: 'Nutty Professor Chicken Burger + Salted French Fries + Thums Up', price: 'â‚¹234', img: '', type: 'nonveg' },
  { category: 'combos', title: 'Spicy Hero Chicken Combo', desc: 'Spicy Hero Chicken Burger + Virgin Mojito', price: 'â‚¹189', img: '', type: 'nonveg' },
  { category: 'combos', title: 'Nacho Vixen Combo', desc: 'Nacho Vixen Burger + Chicken Nuggets + Thums Up', price: 'â‚¹299', img: '', type: 'nonveg' },
  { category: 'combos', title: 'Fiery Fajita Chicken Combo', desc: 'Fiery Fajita Chicken Burger + Green Apple Mojito', price: 'â‚¹224', img: '', type: 'nonveg' },
  { category: 'combos', title: 'Fries & Wings Combo', desc: 'Salted French Fries + Chicken Wings + Virgin Mojito', price: 'â‚¹249', img: '', type: 'nonveg' },
  { category: 'combos', title: 'Nuggets & Momos Combo', desc: 'Chicken Nuggets + Fried Veg Momos + Thums Up', price: 'â‚¹199', img: '', type: 'nonveg' },
  { category: 'combos', title: 'Peri Fries & Nuggets Combo', desc: 'Peri Peri Fries + Veg Nuggets + Blue Iced Mocktail', price: 'â‚¹257', img: '', type: 'veg' },
  { category: 'combos', title: 'Wedges & Cake Combo', desc: 'Potato Wedges + Choco Lava Cake + Green Apple Mojito', price: 'â‚¹239', img: '', type: 'veg' },
  { category: 'combos', title: 'Peri Fries & Nachos Combo', desc: 'Peri Peri Fries + Veg Nachos + Thums Up', price: 'â‚¹278', img: '', type: 'veg' },
  { category: 'combos', title: 'Shedard Chicken Nachos Combo', desc: 'Shedard Chicken Cheese Nachos + Fried Chicken Momos + Green Apple Mojito', price: 'â‚¹409', img: '', type: 'nonveg' },
  { category: 'combos', title: 'Classic Veg Nachos Combo', desc: 'Classic Veg Cheese Nachos + Fried Veg Momos + Virgin Mojito', price: 'â‚¹339', img: '', type: 'veg' },
  { category: 'combos', title: 'Garlic Bread & Chicken Momos Combo', desc: 'Cheese Garlic Bread + Fried Chicken Momos + Thums Up', price: 'â‚¹219', img: '', type: 'nonveg' },
  { category: 'combos', title: 'Garlic Bread & Chicken Nachos Combo', desc: 'Plain Garlic Bread + Shedard Chicken Nachos + Watermelon Mojito', price: 'â‚¹264', img: '', type: 'nonveg' },
  { category: 'combos', title: 'Cold Coffee & Shake Combo', desc: 'Cold Coffee + Belgium Chocolate Shake', price: 'â‚¹269', img: '', type: 'veg' },
  { category: 'combos', title: 'Mango & Oreo Combo', desc: 'King of Mango Milkshake + Oreo Choco Chips Shake', price: 'â‚¹258', img: '', type: 'veg' },
  { category: 'combos', title: 'Strawberry & Chocolate Combo', desc: 'Strawberry Milkshake + Chocolate Cold Coffee', price: 'â‚¹258', img: '', type: 'veg' },
  { category: 'combos', title: 'Oreo Coffee Combo', desc: 'Oreo Coffee Shake + Cold Coffee', price: 'â‚¹268', img: '', type: 'veg' }
];

/* === GLOBAL STATE === */
let cart = JSON.parse(localStorage.getItem('cart')) || [];
let activeCategory = 'all';
let activeType = 'all';
let currentCustomisingItem = null; // To store the item being customized

// reuseable functions start
function extractNumericPrice(priceStr) {
  const match = priceStr?.match(/â‚¹(\d+)/);
  return match ? parseInt(match[1]) : 0;
}

function showCustomiseButton(button) {
  const card = button.closest('.menu-card');
  const customiseBtn = card?.querySelector('.customise-btn');
  if (customiseBtn) customiseBtn.style.display = 'block';
}

function isSimpleItem(item) {
  return !item.selectedSize && !item.customizations && item.category !== 'beverages';
}

function formatCartItemDetails(item) {
  let details = item.title;
  if (item.selectedSize) details += ` (${item.selectedSize})`;
  if (item.customizations) {
    const c = item.customizations;
    if (c.size) details += ` (Size: ${c.size})`;
    if (c.crust && c.crust !== 'Standard') details += ` (Crust: ${c.crust})`;
    if (c.vegToppings?.length) details += ` (Veg Toppings: ${c.vegToppings.join(', ')})`;
    if (c.nonVegToppings?.length) details += ` (Non-Veg Toppings: ${c.nonVegToppings.join(', ')})`;
  }
  return details;
}

function saveCustomisationChanges() {
  addCustomisedItemToCart(false); // Save edits
}

// reuseable functions end

function saveCart() {
  localStorage.setItem('cart', JSON.stringify(cart));
}

function updateCartCountBadge() {
  const count = cart.reduce((sum, item) => sum + item.qty, 0);
  document.getElementById('cartCountBadge').innerText = `(${count})`;

  // Control visibility of the sticky cart button
  const stickyCartBtn = document.getElementById('stickyCartBtn');
  if (count > 0) {
    stickyCartBtn.style.display = 'block';
  } else {
    stickyCartBtn.style.display = 'none';
  }
}

function toggleMenuPopup() {
  const popup = document.getElementById('menuPopup');
  popup.classList.toggle('hidden');
}
// Close popup if clicked outside
document.addEventListener('click', function (e) {
  const popup = document.getElementById('menuPopup');
  const toggleBtn = document.getElementById('menuToggleBtn');

  // If popup is visible and click is outside both popup and button
  if (!popup.classList.contains('hidden') &&
      !popup.contains(e.target) &&
      !toggleBtn.contains(e.target)) {
    popup.classList.add('hidden');
  }
});

/* === CART FUNCTIONS === */
function addToCart(item) {
  // Find an existing item that matches both title and selectedSize (if applicable)
  const existing = cart.find(i => 
    i.title === item.title && 
    (i.selectedSize === item.selectedSize || (!i.selectedSize && !item.selectedSize)) &&
    // For customized items, also check all customization properties for a perfect match
    (JSON.stringify(i.customizations || {}) === JSON.stringify(item.customizations || {}))
  );

  if (existing) {
    existing.qty++;
  } else {
    item.qty = 1;
    cart.push(item);
  }
  renderCart();
  saveCart();
  // For single-price items, update the card state directly.
  // The check for !item.sizes is important here. item.selectedSize would only exist if item.sizes was present initially.
  if (!item.sizes && !item.customizations) { // Only update card state for simple, non-customized items
      updateCardState(item.title, item.qty);
  }
}

function changeQty(index, delta) {
  const item = cart[index];
  item.qty += delta;
  
  if (item.qty <= 0) {
      cart.splice(index, 1);
      // Only update card state if it's a non-sized, non-customized item being fully removed
      if (isSimpleItem(item)) { updateCardState(item.title, 0); }

  } else {
      // For non-sized, non-customized items, update the card state to reflect new quantity
      if (isSimpleItem(item)) {
          updateCardState(item.title, item.qty);
      }
  }
  renderCart();
  saveCart();
}

function removeItem(index) {
  const item = cart[index];
  cart.splice(index, 1);
  renderCart();
  saveCart();
  // Only update card state for items that don't have selectedSize or customizations property
  if (isSimpleItem(item)) { updateCardState(item.title, 0); }
}

function openCartCustomise(cartIndex) {
  const item = cart[cartIndex];
  currentCustomisingItem = menuData.find(m => m.title === item.title);
  if (!currentCustomisingItem) return alert("Original item not found.");

  // Pre-fill modal
  openCustomiseModal(item.title, item); // prefill with item

  // Save index for editing
  document.getElementById('customiseModal').dataset.cartIndex = cartIndex;

  // Show the "Save Edits" button
  document.getElementById('saveEditBtn').style.display = 'inline-block';
}

function renderCart() {
  const list = document.getElementById('cartItems');
  const totalEl = document.getElementById('cartTotal');
  list.innerHTML = '';
  let total = 0;

  cart.forEach((item, i) => {
    const itemPrice = extractNumericPrice(item.price);
    const itemTotal = itemPrice * item.qty;
    total += itemTotal;
    const canCustomize = item.selectedSize || item.customizations;

    let decrementButtonHtml;
    if (item.qty === 1) {
      decrementButtonHtml = `<button class="qty-btn delete" onclick="removeItem(${i})">Ã—</button>`;
    } else {
      decrementButtonHtml = `<button class="qty-btn" onclick="changeQty(${i}, -1)">âˆ’</button>`;
    }

    // === Cart item details with Customise beside title ===
    let itemDetailsHtml = `<div class="cart-item-info"><span class="title">${item.title}`;

    if (canCustomize) {
      itemDetailsHtml += ` <button class="customise-btn-cart" onclick="openCartCustomise(${i})">Customise</button>`;
    }

    itemDetailsHtml += `</span>`;

    // Show size if present
    if (item.selectedSize) {
      itemDetailsHtml += `<span class="cart-item-size"> (${item.selectedSize})</span>`;
    }

    // Show toppings/customizations
    if (item.customizations) {
      const c = item.customizations;
      if (c.size) itemDetailsHtml += `<div class="cart-topping-line">Size: ${c.size} (â‚¹${c.sizePrice})</div>`;
      if (c.crust && c.crust !== 'Standard') itemDetailsHtml += `<div class="cart-topping-line">Crust: ${c.crust} (â‚¹${c.crustPrice})</div>`;
      if (c.vegToppings?.length) itemDetailsHtml += `<div class="cart-topping-line">Veg Toppings: ${c.vegToppings.map(t => `${t.name} (â‚¹${t.price})`).join(', ')}</div>`;
      if (c.nonVegToppings?.length) itemDetailsHtml += `<div class="cart-topping-line">Non-Veg Toppings: ${c.nonVegToppings.map(t => `${t.name} (â‚¹${t.price})`).join(', ')}</div>`;
    }

    itemDetailsHtml += `</div>`;

    // === Render full cart item ===
    list.innerHTML += `
      <li>
        ${itemDetailsHtml}
        <div class="cart-quantity-controls">
          ${decrementButtonHtml}
          <span>${item.qty}</span>
          <button class="qty-btn" onclick="changeQty(${i}, 1)">+</button>
        </div>
        <span class="cart-item-price">â‚¹${itemTotal}</span>
      </li>`;
  });

  totalEl.innerText = `â‚¹${total}`;
  updateCartCountBadge();

  // Auto-close cart if empty
  if (cart.length === 0) {
    closeCartModal();
  }
}

/* === MENU DISPLAY & FILTERING === */
function renderMenuItems() {
  const container = document.getElementById('menu');
  container.innerHTML = ''; // Clear existing content for re-render on filter/search
  const searchValue = document.getElementById('searchBox')?.value.toLowerCase() || '';

  const filteredItems = menuData.filter(item =>
    (activeCategory === 'all' || item.category === activeCategory) &&
    (activeType === 'all' || item.type === activeType) &&
    (item.title.toLowerCase().includes(searchValue) || (item.desc && item.desc.toLowerCase().includes(searchValue)))
  );

  filteredItems.forEach(item => {
    const card = document.createElement('div');
    card.className = `menu-card ${item.type}`;
    card.dataset.title = item.title; // Add data-title for easy lookup
    const iconClass = item.type === 'veg' ? 'veg-icon' : 'nonveg-icon';

    let actionHtml = '';
    let priceDisplayHtml = '';

    if (item.sizes) {
      // Show all size-price options in plain text (no dropdown)
      priceDisplayHtml = '<div class="price-line">';
      for (const size in item.sizes) {
        priceDisplayHtml += `<span class="size-price">${size} - ${item.sizes[size]}</span> `;
      }
      priceDisplayHtml += '</div>';

      actionHtml = `
        <button class="order-button"
          data-title="${item.title}"
          data-type="${item.type}"
          data-desc="${item.desc || ''}"
          onclick="addToCartFromSizedItem(this, '${item.title.replace(/\s/g, '-')}')"
        >ADD</button>`;
    } else {
      priceDisplayHtml = `<div class="price-line"><span class="discounted-price">${item.price}</span></div>`;

      const itemInCart = cart.find(cartItem => cartItem.title === item.title && !cartItem.selectedSize && !cartItem.customizations);
      const currentQty = itemInCart ? itemInCart.qty : 0;

      if (currentQty > 0) {
        const decrementButtonClass = currentQty === 1 ? 'qty-btn delete' : 'qty-btn';
        const decrementButtonText = currentQty === 1 ? 'x' : 'âˆ’';
        actionHtml = `
          <div class="quantity-control">
            <button class="${decrementButtonClass}" onclick="changeCardQty(this, '${item.title}', -1)">${decrementButtonText}</button>
            <span class="qty-count">${currentQty}</span>
            <button class="qty-btn" onclick="changeCardQty(this, '${item.title}', 1)">+</button>
          </div>`;
      } else {
        actionHtml = `
          <button class="order-button"
            data-title="${item.title}"
            data-desc="${item.desc || ''}"
            data-price="${item.price}"
            data-img="${item.img || ''}"
            data-type="${item.type}"
            onclick="addToCartFromButton(this)"
          >ADD</button>`;
      }
    }

    card.innerHTML = `
      <div class="menu-info">
        <div><span class="${iconClass}"></span><strong>${item.title}</strong></div>
        ${priceDisplayHtml}
        <p>${item.desc || ''}</p>
      </div>
      <div class="menu-img-block">
        <img src="${item.img || ''}" alt="${item.title}">
        ${actionHtml}
      </div>`;
    container.appendChild(card);
  });
}

function updateCardState(itemTitle, newQty) {
    const card = document.querySelector(`.menu-card[data-title="${itemTitle}"]`);
    if (!card) return; // Card not found, might be filtered out

    const originalMenuItem = menuData.find(menuItem => menuItem.title === itemTitle);
    if (!originalMenuItem || originalMenuItem.sizes) return; // Only update non-sized items
    if (originalMenuItem.customizations) return; // Do not update card for customized items directly

    const imgBlock = card.querySelector('.menu-img-block');
    let actionHtml;

    if (newQty > 0) {
      const decBtn = newQty === 1 ? 'x' : 'âˆ’';
      const decClass = newQty === 1 ? 'qty-btn delete' : 'qty-btn';
      actionHtml = `
        <div class="quantity-control">
          <button class="${decClass}" onclick="changeCardQty(this, '${itemTitle}', -1)">${decBtn}</button>
          <span class="qty-count">${newQty}</span>
          <button class="qty-btn" onclick="changeCardQty(this, '${itemTitle}', 1)">+</button>
        </div>`;
    } else {
        actionHtml = `
            <button class="order-button"
              data-title="${originalMenuItem.title}"
              data-desc="${originalMenuItem.desc || ''}"
              data-price="${originalMenuItem.price}"
              data-img="${originalMenuItem.img || ''}"
              data-type="${originalMenuItem.type}"
              onclick="addToCartFromButton(this)">ADD</button>`;
    }
    // Retain the customise button
    imgBlock.innerHTML = `<img src="${originalMenuItem.img || ''}" alt="${itemTitle}">` + actionHtml;
}

// For single-price items
function addToCartFromButton(button) {
  const item = {
    title: button.dataset.title,
    desc: button.dataset.desc,
    price: button.dataset.price,
    img: button.dataset.img,
    type: button.dataset.type
  };
  const original = menuData.find(i => i.title === item.title);
  if (original?.category === 'beverages') {
    addToCart(item); // Direct add for beverages
  } else {
    showCustomiseButton(button);
    openCustomiseModal(item.title); // Customise for others
  }
}

// For multi-size items
function addToCartFromSizedItem(button, titleId) {
  const originalTitle = button.dataset.title;
  const originalMenuItem = menuData.find(menuItem => menuItem.title === originalTitle);

  if (!originalMenuItem || !originalMenuItem.sizes) {
    console.error("Error: Could not find item or its sizes.");
    return;
  }

  const selectedSize = "Regular"; // Default size
  const price = originalMenuItem.sizes[selectedSize];

  if (!price) {
    console.error(`Regular size not available for: ${originalTitle}`);
    return;
  }

  const itemToAdd = {
    title: originalTitle,
    selectedSize: selectedSize,
    desc: originalMenuItem.desc,
    price: price,
    img: originalMenuItem.img,
    type: originalMenuItem.type
  };

  if (originalMenuItem.category === 'beverages') {
    addToCart(itemToAdd);
  } else {
    showCustomiseButton(button);
    openCustomiseModal(originalTitle);
  }
}

// This function is only for single-price items on the card.
// Quantity changes for sized items happen only in the cart modal.
function changeCardQty(btn, title, delta) {
  const itemInCart = cart.find(i => i.title === title && !i.selectedSize && !i.customizations);

  if (!itemInCart && delta < 0) return;

  if (itemInCart) {
    itemInCart.qty += delta;
    if (itemInCart.qty <= 0) {
      cart = cart.filter(i => (i.title !== title || i.selectedSize || i.customizations));

      // Hide Customise when qty = 0
      const card = btn.closest('.menu-card');
      const customiseBtn = card.querySelector('.customise-btn');
      if (customiseBtn) {
        customiseBtn.style.display = 'none';
      }
    }
  } else if (delta > 0) {
    const originalItem = menuData.find(d => d.title === title && !d.sizes);
    if (originalItem) {
      cart.push({ ...originalItem, qty: 1 });
    }
  }

  saveCart();
  renderCart();
  updateCardState(title, itemInCart ? itemInCart.qty : 0);
}

/* === MODALS & ACTIONS === */
function openCartModal() {
  document.getElementById('cartModal').style.display = 'flex';
}

function closeCartModal() {
  document.getElementById('cartModal').style.display = 'none';
}

function openOrderForm() {
  document.getElementById('cartModal').style.display = 'none';
  document.getElementById('orderFormModal').style.display = 'flex';
}

function closeOrderForm() {
  document.getElementById('orderFormModal').style.display = 'none';
}

function submitOrder(e) {
  e.preventDefault();
  const name = document.getElementById('custName').value;
  const address = document.getElementById('custAddress').value;
  const phone = document.getElementById('custPhone').value;

  let message = `*Order from Pizza Factory Slise*%0A`;
  const orderedItems = [...cart]; // Take a snapshot of the cart before clearing
  orderedItems.forEach(item => {
    // Safely extract numeric part of the price
    const itemPrice = extractNumericPrice(item.price);

    message += `ðŸ• ${formatCartItemDetails(item)} - â‚¹${item.price} x ${item.qty}%0A`;

  });

  const total = document.getElementById('cartTotal').innerText;
  message += `%0A*Total*: ${total}%0A`;
  message += `%0A*Customer Details*:%0AðŸ‘¤ ${name}%0AðŸ  ${address}%0AðŸ“ž ${phone}`;

  const whatsappUrl = `https://wa.me/919182714776?text=${encodeURIComponent(message)}`; // Replace with your WhatsApp business number
  window.open(whatsappUrl, '_blank');

  cart = []; // Clear the cart
  renderCart(); // Update cart modal to show empty
  saveCart();
  closeOrderForm();
  
  // Reset all menu cards to "ADD" state after order (only for single-price items)
  orderedItems.forEach(item => {
      if (isSimpleItem(item)) { updateCardState(item.title, 0); }

  });
}

/* === Customise Modal Functions === */
function updateCustomiseTotalPrice() {
  let total = 0;

  // Size price
  const sizeInput = document.querySelector('input[name="pizzaSize"]:checked');
  const sizePrice = parseInt(sizeInput?.dataset.price || '0');
  total += sizePrice;

  // Crust price
  const crustInput = document.querySelector('input[name="pizzaCrust"]:checked');
  const crustPrice = parseInt(crustInput?.dataset.price || '0');
  total += crustPrice;

  // Veg toppings
  document.querySelectorAll('input[name="vegTopping"]:checked').forEach(cb => {
    total += parseInt(cb.dataset.price || '0');
  });

  // Non-Veg toppings
  document.querySelectorAll('input[name="nonVegTopping"]:checked').forEach(cb => {
    total += parseInt(cb.dataset.price || '0');
  });

  // Update DOM
  document.getElementById('customiseTotalPrice').innerText = `â‚¹${total}`;
}

function openCustomiseModal(itemTitle, existingItem = null) {
  currentCustomisingItem = menuData.find(item => item.title === itemTitle);
  if (!currentCustomisingItem) {
    console.error("Item not found for customization:", itemTitle);
    return;
  }

  document.getElementById('customisePizzaName').innerText = currentCustomisingItem.title;

  // Hide Save Edits button by default
  document.getElementById('saveEditBtn').style.display = 'none';

  const sizeOptionGroup = document.querySelector('.option-group:has(input[name="pizzaSize"])');
  let sizeOptionsHtml = '<h4>Change Size</h4>';
  const category = currentCustomisingItem.category;

  // Show or hide crust and topping sections based on category
const crustSection = document.querySelector('.option-group:has(input[name="pizzaCrust"])');
const vegToppingSection = document.querySelector('.option-group:has(input[name="vegTopping"])');
const nonVegToppingSection = document.querySelector('.option-group:has(input[name="nonVegTopping"])');

if (category === 'beverages') {
  crustSection.style.display = 'none';
  vegToppingSection.style.display = 'none';
  nonVegToppingSection.style.display = 'none';
} else {
  crustSection.style.display = 'block';
  vegToppingSection.style.display = 'block';
  nonVegToppingSection.style.display = 'block';
}

  if (category === 'beverages') {
    const beverageSizes = [
      { label: '200ml', price: 40 },
      { label: '500ml', price: 50 },
      { label: '1.5L', price: 70 },
      { label: '2.5L', price: 100 },
    ];
    beverageSizes.forEach((s, i) => {
      sizeOptionsHtml += `
        <label>
          <input type="radio" name="pizzaSize" value="${s.label}" data-price="${s.price}" ${i === 0 ? 'checked' : ''}>
          ${s.label}: â‚¹${s.price}
        </label>`;
    });
    sizeOptionGroup.style.display = 'block';
    sizeOptionGroup.innerHTML = sizeOptionsHtml;

  } else if ((category === 'pizzas' || category === 'burgers') && currentCustomisingItem.sizes) {
    for (const size in currentCustomisingItem.sizes) {
  const price = parseInt(currentCustomisingItem.sizes[size].replace('â‚¹', ''));
  const checkedAttr = size === 'Regular' ? 'checked' : '';
  sizeOptionsHtml += `
    <label>
      <input type="radio" name="pizzaSize" value="${size}" data-price="${price}" ${checkedAttr}>
      ${size}: â‚¹${price}
    </label>`;
}

    sizeOptionGroup.style.display = 'block';
    sizeOptionGroup.innerHTML = sizeOptionsHtml;

  } else {
    const basePrice = parseInt(currentCustomisingItem.price.replace('â‚¹', ''));
    sizeOptionsHtml += `
      <label>
        <input type="radio" name="pizzaSize" value="Regular" data-price="${basePrice}" checked>
        Regular: â‚¹${basePrice}
      </label>`;
    sizeOptionGroup.style.display = 'block';
    sizeOptionGroup.innerHTML = sizeOptionsHtml;
  }

  // Reset all selections
  document.querySelectorAll('input[name="pizzaCrust"]').forEach(i => i.checked = i.value === 'Standard');
  document.querySelectorAll('input[name="vegTopping"]').forEach(i => i.checked = false);
  document.querySelectorAll('input[name="nonVegTopping"]').forEach(i => i.checked = false);

  // Apply existing values if editing
  if (existingItem?.customizations) {
    const c = existingItem.customizations;
    
    if (c.size) {
      const sizeRadio = document.querySelector(`input[name="pizzaSize"][value="${c.size}"]`);
      if (sizeRadio) sizeRadio.checked = true;
    }

    if (c.crust) {
      const crustRadio = document.querySelector(`input[name="pizzaCrust"][value="${c.crust}"]`);
      if (crustRadio) crustRadio.checked = true;
    }

    c.vegToppings?.forEach(t => {
      const checkbox = document.querySelector(`input[name="vegTopping"][value="${t.name}"]`);
      if (checkbox) checkbox.checked = true;
    });

    c.nonVegToppings?.forEach(t => {
      const checkbox = document.querySelector(`input[name="nonVegTopping"][value="${t.name}"]`);
      if (checkbox) checkbox.checked = true;
    });
  }

  setTimeout(() => {
  document.querySelectorAll('#customiseModal input').forEach(input => {
    input.addEventListener('change', updateCustomiseTotalPrice);
  });
  updateCustomiseTotalPrice(); // Initial calculation
}, 0);

  // Show modal
  document.getElementById('customiseModal').style.display = 'flex';
}

function closeCustomiseModal() {
  document.getElementById('customiseModal').style.display = 'none';
  delete document.getElementById('customiseModal').dataset.cartIndex;
}

function calculateCustomPrice() {
    let basePrice = 0;

    // Get selected size price
    const selectedSizeRadio = document.querySelector('input[name="pizzaSize"]:checked');
    if (selectedSizeRadio) {
        basePrice += parseInt(selectedSizeRadio.dataset.price);
    } else if (currentCustomisingItem && !currentCustomisingItem.sizes) {
        // If no size radio is checked (e.g., initially for a single-price item),
        // and it's a single-price item, use its original price as base.
        basePrice = parseInt(currentCustomisingItem.price.replace('â‚¹', ''));
    }

    // Get selected crust price
    const selectedCrustRadio = document.querySelector('input[name="pizzaCrust"]:checked');
    if (selectedCrustRadio) {
        basePrice += parseInt(selectedCrustRadio.dataset.price);
    }

    // Add veg toppings price
    document.querySelectorAll('input[name="vegTopping"]:checked').forEach(checkbox => {
        basePrice += parseInt(checkbox.dataset.price);
    });

    // Add non-veg toppings price
    document.querySelectorAll('input[name="nonVegTopping"]:checked').forEach(checkbox => {
        basePrice += parseInt(checkbox.dataset.price);
    });

    document.getElementById('customiseTotalPrice').innerText = `â‚¹${basePrice}`;
}

function addCustomisedItemToCart(asNew = false) {
  const sizeInput = document.querySelector('input[name="pizzaSize"]:checked');
  const crustInput = document.querySelector('input[name="pizzaCrust"]:checked');
  const vegInputs = [...document.querySelectorAll('input[name="vegTopping"]:checked')];
  const nonVegInputs = [...document.querySelectorAll('input[name="nonVegTopping"]:checked')];

  const customizations = {
    size: sizeInput?.value,
    sizePrice: parseInt(sizeInput?.dataset.price || '0'),
    crust: crustInput?.value || 'Standard',
    crustPrice: parseInt(crustInput?.dataset.price || '0'),
    vegToppings: vegInputs.map(i => ({ name: i.value, price: parseInt(i.dataset.price || '0') })),
    nonVegToppings: nonVegInputs.map(i => ({ name: i.value, price: parseInt(i.dataset.price || '0') }))
  };

  const totalPrice = customizations.sizePrice + customizations.crustPrice +
  customizations.vegToppings.reduce((sum, t) => sum + t.price, 0) +
  customizations.nonVegToppings.reduce((sum, t) => sum + t.price, 0);

  const newItem = {
    title: currentCustomisingItem.title,
    desc: currentCustomisingItem.desc,
    type: currentCustomisingItem.type,
    customizations,
    price: `â‚¹${totalPrice}`,
    qty: 1
  };

  const cartIndex = document.getElementById('customiseModal').dataset.cartIndex;

  if (!asNew && cartIndex !== undefined && cart[cartIndex]) {
    // Replace the existing item in cart
    cart[cartIndex] = newItem;
  } else {
    // Add as new item
    cart.push(newItem);
  }

  saveCart();
  renderCart();
  closeCustomiseModal();
}

/* === UI FILTERS === */
function openTab(evt, category) {
  document.querySelectorAll('.tablink').forEach(btn => btn.classList.remove('active'));
  evt.target.classList.add('active');
  activeCategory = category;
  renderMenuItems(); // Re-render all filtered items
}

function filterByType(evt, type) {
  document.querySelectorAll('.type-filter').forEach(btn => btn.classList.remove('active'));
  evt.target.classList.add('active');
  activeType = type;
  renderMenuItems(); // Re-render all filtered items
}

function searchMenu() {
  renderMenuItems(); // Re-render all filtered items
}

function handleModalOutsideClick(event, modalId) {
  const modal = document.getElementById(modalId);
  if (event.target === modal) {
    modal.style.display = 'none';
  }
}

window.onload = () => {
  renderMenuItems(); // Initial render of all items
  renderCart(); // Initial render of cart
  // Set initial active filter button
  document.querySelector('.type-filter[onclick="filterByType(event, \'all\')"]').classList.add('active');
};
function makePayment() {
  const name = document.getElementById('custName').value;
  const address = document.getElementById('custAddress').value;
  const phone = document.getElementById('custPhone').value;
  const totalAmount = parseInt(document.getElementById('cartTotal').innerText.replace('â‚¹', ''));

  if (!name || !address || !phone || totalAmount <= 0) {
    alert("Please fill all details and add at least one item to cart.");
    return;
  }

  const options = {
    key: "YOUR_RAZORPAY_KEY", // Replace with your Razorpay key
    amount: totalAmount * 100,
    currency: "INR",
    name: "Pizza Factory Slise",
    description: "Order Payment",
    handler: function (response) {
      const paymentId = response.razorpay_payment_id;
      let message = `*Order Confirmed!* âœ…%0A`;
      message += `ðŸ§¾ *Receipt ID*: ${paymentId}%0A`;
      message += `ðŸ‘¤ *Name*: ${name}%0AðŸ  *Address*: ${address}%0AðŸ“ž *Phone*: ${phone}%0A`;
      message += `%0A*Items Ordered:*%0A`;

      cart.forEach(item => {
        const priceMatch = item.price.match(/â‚¹(\d+)/); // Use regex to get just the number
        const price = priceMatch ? priceMatch[1] : 'Price Not Found'; // Get the captured group
        message += `ðŸ• ${formatCartItemDetails(item)} - â‚¹${item.price} x ${item.qty}%0A`;
      });

      message += `%0AðŸ’° *Total*: â‚¹${totalAmount}`;

      const userWhatsApp = `https://wa.me/91${phone}?text=${encodeURIComponent(message)}`;
      window.open(userWhatsApp, '_blank');

      const adminNumber = "918297422016"; // Replace with your WhatsApp number
      const adminWhatsApp = `https://wa.me/${adminNumber}?text=${encodeURIComponent(message)}`;
      window.open(adminWhatsApp, '_blank');

      alert("âœ… Payment Successful!\nðŸ§¾ Payment ID: " + paymentId);
      cart = [];
      renderCart();
      saveCart();
      closeOrderForm();
    },
    prefill: {
      name: name,
      contact: phone
    },
    theme: {
      color: "#ce221f"
    }
  };

  const rzp = new Razorpay(options);
  rzp.open();
}
</script>
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
</body>
</html>